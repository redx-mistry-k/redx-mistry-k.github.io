<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Budget Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f7f9fc;
        color: #333;
        line-height: 1.6;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
        color: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 2.2rem;
        margin-bottom: 10px;
      }

      h2 {
        font-size: 1.5rem;
        margin: 25px 0 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #4b6cb7;
        color: #2c3e50;
      }

      .summary-cards {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        flex: 1;
        min-width: 250px;
        text-align: center;
        transition: transform 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card h3 {
        color: #4b6cb7;
        margin-bottom: 15px;
      }

      .card p {
        font-size: 1.8rem;
        font-weight: bold;
        color: #2c3e50;
      }

      .card .percentage {
        font-size: 1.2rem;
        margin-top: 10px;
      }

      .positive {
        color: #27ae60;
      }

      .negative {
        color: #e74c3c;
      }

      .neutral {
        color: #7f8c8d;
      }

      .form-container {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        align-items: end;
      }

      .form-grid > div {
        display: flex;
        flex-direction: column;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        transition: border 0.3s;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #4b6cb7;
        box-shadow: 0 0 0 2px rgba(75, 108, 183, 0.2);
      }

      button {
        background: #4b6cb7;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s;
      }

      button:hover {
        background: #3a5795;
        transform: translateY(-2px);
      }

      .form-button-container {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 10px;
      }

      .diagram-container {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        overflow: hidden;
      }

      #sankeyDiagram {
        width: 100%;
        height: 400px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      }

      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #4b6cb7;
        color: white;
        font-weight: 600;
      }

      tr:nth-child(even) {
        background-color: #f8f9fa;
      }

      tr:hover {
        background-color: #f1f3f5;
      }

      .income-amount {
        color: #27ae60;
        font-weight: bold;
      }

      .expense-amount {
        color: #e74c3c;
        font-weight: bold;
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .actions button {
        padding: 6px 12px;
        font-size: 0.9rem;
      }

      .delete-btn {
        background: #e74c3c;
      }

      .delete-btn:hover {
        background: #c0392b;
      }

      .edit-btn {
        background: #f39c12;
      }

      .edit-btn:hover {
        background: #d68910;
      }

      .no-data {
        text-align: center;
        padding: 40px;
        color: #7f8c8d;
        font-style: italic;
      }

      .controls {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-bottom: 15px;
      }

      .reset-btn {
        background: #95a5a6;
      }

      .reset-btn:hover {
        background: #7f8c8d;
      }

      .export-btn {
        background: #2ecc71;
      }

      .export-btn:hover {
        background: #27ae60;
      }

      .import-btn {
        background: #3498db;
      }

      .import-btn:hover {
        background: #2980b9;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h3 {
        color: #2c3e50;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #7f8c8d;
      }

      .modal-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      @media (max-width: 768px) {
        .summary-cards {
          flex-direction: column;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        th,
        td {
          padding: 10px;
          font-size: 0.9rem;
        }

        .form-button-container {
          flex-direction: column;
        }

        .controls {
          flex-direction: column;
        }
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: 600;
        z-index: 1001;
        animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
        animation-fill-mode: forwards;
      }

      .notification.success {
        background-color: #27ae60;
      }

      .notification.error {
        background-color: #e74c3c;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .node-label {
        font-weight: bold;
        font-size: 12px;
        fill: #2c3e50;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Monthly Budget Tracker</h1>
      <p>Visualize how your income flows to expenses and savings</p>
    </header>

    <div class="summary-cards">
      <div class="card">
        <h3>Total Income</h3>
        <p id="totalIncome">₹0.00</p>
      </div>
      <div class="card">
        <h3>Total Expenses</h3>
        <p id="totalExpenses">₹0.00</p>
      </div>
      <div class="card">
        <h3>Balance</h3>
        <p id="balance">₹0.00</p>
        <div class="percentage" id="savingsRate">Savings Rate: 0%</div>
      </div>
    </div>

    <div class="form-container">
      <h2>Add New Budget Item</h2>
      <p>Enter your income or expense details below</p>
      <form id="budgetForm">
        <div class="form-grid">
          <div>
            <label for="type">Type</label>
            <select id="type" required>
              <option value="Income">Income</option>
              <option value="Expense">Expense</option>
            </select>
          </div>

          <div>
            <label for="category">Category</label>
            <select id="category" required>
              <!-- Categories will be populated dynamically -->
            </select>
          </div>

          <div>
            <label for="amount">Amount (₹)</label>
            <input
              type="number"
              id="amount"
              placeholder="Enter amount"
              min="0"
              step="0.01"
              required
            />
          </div>

          <div>
            <label for="date">Date</label>
            <input type="date" id="date" required />
          </div>

          <div>
            <label for="description">Description (Optional)</label>
            <input
              type="text"
              id="description"
              placeholder="Enter description"
            />
          </div>

          <div class="form-button-container">
            <button type="button" id="clearForm">Clear</button>
            <button type="submit" id="submitBtn">Add Item</button>
          </div>
        </div>
      </form>
    </div>

    <div class="controls">
      <button class="reset-btn" id="resetAllBtn">Reset All Data</button>
      <button class="export-btn" id="exportBtn">Export Data</button>
      <button class="import-btn" id="importBtn">Import Data</button>
    </div>

    <div class="diagram-container">
      <h2>Budget Flow Diagram</h2>
      <p>Visualizing how your income is allocated to expenses and savings:</p>
      <div id="sankeyDiagram"></div>
    </div>

    <h2>Your Budget Items</h2>
    <table>
      <thead>
        <tr>
          <th>TYPE</th>
          <th>CATEGORY</th>
          <th>AMOUNT</th>
          <th>DESCRIPTION</th>
          <th>DATE</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody id="budgetTable">
        <!-- Budget items will be dynamically added here -->
      </tbody>
    </table>

    <!-- Reset Confirmation Modal -->
    <div id="resetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Reset All Data</h3>
          <button class="close-btn">&times;</button>
        </div>
        <p>Are you sure you want to delete all budget data? This action cannot be undone.</p>
        <div class="modal-buttons">
          <button class="reset-btn" id="confirmReset">Yes, Reset All</button>
          <button class="cancel-btn" id="cancelReset">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Import Budget Data</h3>
          <button class="close-btn">&times;</button>
        </div>
        <p>Paste your exported budget data (JSON format):</p>
        <textarea id="importData" rows="10" style="width: 100%; margin: 15px 0; padding: 10px;"></textarea>
        <div class="modal-buttons">
          <button class="import-btn" id="confirmImport">Import Data</button>
          <button class="cancel-btn" id="cancelImport">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      // Define income and expense categories
      const incomeCategories = [
        "Salary",
        "Freelance",
        "Investments",
        "Gifts",
        "Other Income",
      ];

      const expenseCategories = [
        "Housing",
        "Utilities",
        "Food",
        "Transportation",
        "Healthcare",
        "Entertainment",
        "Education",
        "Shopping",
        "Other Expenses",
      ];

      // Budget data storage - start with empty array for new users
      let budgetData = [];
      let editIndex = null;

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        loadFromLocalStorage();
        setupEventListeners();
        initializeForm();
        updateUI();
      });

      // Load data from localStorage
      function loadFromLocalStorage() {
        const savedData = localStorage.getItem("budgetData");
        if (savedData) {
          try {
            budgetData = JSON.parse(savedData);
          } catch (e) {
            console.error("Error loading saved data:", e);
            budgetData = [];
          }
        } else {
          budgetData = []; // Start fresh for new users
        }
      }

      // Save data to localStorage
      function saveToLocalStorage() {
        localStorage.setItem("budgetData", JSON.stringify(budgetData));
      }

      // Setup all event listeners
      function setupEventListeners() {
        const typeSelect = document.getElementById("type");
        const categorySelect = document.getElementById("category");
        const form = document.getElementById("budgetForm");
        const clearFormBtn = document.getElementById("clearForm");
        const resetAllBtn = document.getElementById("resetAllBtn");
        const exportBtn = document.getElementById("exportBtn");
        const importBtn = document.getElementById("importBtn");
        const closeModalBtns = document.querySelectorAll(".close-btn, .cancel-btn");
        const confirmResetBtn = document.getElementById("confirmReset");
        const confirmImportBtn = document.getElementById("confirmImport");
        const cancelImportBtn = document.getElementById("cancelImport");

        // Update category options when type changes
        typeSelect.addEventListener("change", updateCategoryOptions);

        // Form submission
        form.addEventListener("submit", handleFormSubmit);

        // Clear form button
        clearFormBtn.addEventListener("click", initializeForm);

        // Reset all data button
        resetAllBtn.addEventListener("click", () => showModal("resetModal"));

        // Export button
        exportBtn.addEventListener("click", exportData);

        // Import button
        importBtn.addEventListener("click", () => showModal("importModal"));

        // Modal close buttons
        closeModalBtns.forEach(btn => {
          btn.addEventListener("click", closeAllModals);
        });

        // Confirm reset
        confirmResetBtn.addEventListener("click", resetAllData);

        // Confirm import
        confirmImportBtn.addEventListener("click", importData);

        // Close modal when clicking outside
        window.addEventListener("click", (e) => {
          if (e.target.classList.contains("modal")) {
            closeAllModals();
          }
        });
      }

      // Initialize form with default values
      function initializeForm() {
        document.getElementById("type").value = "Income";
        document.getElementById("amount").value = "";
        document.getElementById("date").valueAsDate = new Date();
        document.getElementById("description").value = "";
        updateCategoryOptions();
        editIndex = null;
        document.getElementById("submitBtn").textContent = "Add Item";
      }

      // Update category dropdown based on type selection
      function updateCategoryOptions() {
        const type = document.getElementById("type").value;
        const categorySelect = document.getElementById("category");
        
        categorySelect.innerHTML = "";
        
        const categories = type === "Income" ? incomeCategories : expenseCategories;
        
        categories.forEach(category => {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          categorySelect.appendChild(option);
        });
      }

      // Handle form submission
      function handleFormSubmit(e) {
        e.preventDefault();

        const type = document.getElementById("type").value;
        const category = document.getElementById("category").value;
        const amount = parseFloat(document.getElementById("amount").value);
        const date = document.getElementById("date").value;
        const description = document.getElementById("description").value.trim();

        if (isNaN(amount) || amount <= 0) {
          showNotification("Please enter a valid amount", "error");
          return;
        }

        const item = {
          type,
          category,
          amount,
          date,
          description,
          id: Date.now() // Unique ID for each item
        };

        if (editIndex !== null) {
          // Edit existing item
          budgetData[editIndex] = item;
          showNotification("Item updated successfully", "success");
        } else {
          // Add new item
          budgetData.push(item);
          showNotification("Item added successfully", "success");
        }

        saveToLocalStorage();
        updateUI();
        initializeForm();
      }

      // Update all UI components
      function updateUI() {
        renderBudgetTable();
        updateSankeyDiagram();
        updateSummaryCards();
      }

      // Format currency in Indian Rupees
      function formatCurrency(amount) {
        return new Intl.NumberFormat("en-IN", {
          style: "currency",
          currency: "INR",
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }).format(amount);
      }

      // Render the budget table
      function renderBudgetTable() {
        const tableBody = document.getElementById("budgetTable");
        
        if (budgetData.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="6" class="no-data">
                No budget items yet. Add your first income or expense above!
              </td>
            </tr>
          `;
          return;
        }

        // Sort by date (newest first)
        const sortedData = [...budgetData].sort((a, b) => new Date(b.date) - new Date(a.date));

        tableBody.innerHTML = sortedData.map((item, index) => {
          const formattedDate = new Date(item.date).toLocaleDateString("en-GB", {
            day: "2-digit",
            month: "short",
            year: "numeric",
          });

          return `
            <tr>
              <td><strong>${item.type}</strong></td>
              <td>${item.category}</td>
              <td class="${item.type.toLowerCase()}-amount">${formatCurrency(item.amount)}</td>
              <td>${item.description || "-"}</td>
              <td>${formattedDate}</td>
              <td class="actions">
                <button class="edit-btn" onclick="editItem(${index})">Edit</button>
                <button class="delete-btn" onclick="deleteItem(${index})">Delete</button>
              </td>
            </tr>
          `;
        }).join("");
      }

      // Edit an item
      window.editItem = function(index) {
        const item = budgetData[index];
        document.getElementById("type").value = item.type;
        document.getElementById("amount").value = item.amount;
        document.getElementById("date").value = item.date;
        document.getElementById("description").value = item.description || "";
        updateCategoryOptions();
        document.getElementById("category").value = item.category;
        editIndex = index;
        document.getElementById("submitBtn").textContent = "Update Item";
        
        // Scroll to form
        document.querySelector(".form-container").scrollIntoView({ behavior: 'smooth' });
      };

      // Delete an item
      window.deleteItem = function(index) {
        if (confirm("Are you sure you want to delete this item?")) {
          budgetData.splice(index, 1);
          saveToLocalStorage();
          updateUI();
          showNotification("Item deleted successfully", "success");
        }
      };

      // Update summary cards
      function updateSummaryCards() {
        const totalIncome = budgetData
          .filter(item => item.type === "Income")
          .reduce((sum, item) => sum + item.amount, 0);

        const totalExpenses = budgetData
          .filter(item => item.type === "Expense")
          .reduce((sum, item) => sum + item.amount, 0);

        const balance = totalIncome - totalExpenses;
        const savingsRate = totalIncome > 0 ? ((balance / totalIncome) * 100).toFixed(1) : 0;

        document.getElementById("totalIncome").textContent = formatCurrency(totalIncome);
        document.getElementById("totalExpenses").textContent = formatCurrency(totalExpenses);
        document.getElementById("balance").textContent = formatCurrency(balance);
        
        const savingsRateElement = document.getElementById("savingsRate");
        savingsRateElement.textContent = `Savings Rate: ${savingsRate}%`;
        
        // Color code based on savings rate
        savingsRateElement.className = "percentage";
        if (savingsRate > 20) {
          savingsRateElement.classList.add("positive");
        } else if (savingsRate > 0) {
          savingsRateElement.classList.add("neutral");
        } else {
          savingsRateElement.classList.add("negative");
        }
      }

      // Update the Sankey diagram
      function updateSankeyDiagram() {
        // Clear previous diagram
        d3.select("#sankeyDiagram").selectAll("*").remove();

        // Calculate totals
        const totalIncome = budgetData
          .filter(item => item.type === "Income")
          .reduce((sum, item) => sum + item.amount, 0);

        // If no income, show message
        if (totalIncome <= 0) {
          d3.select("#sankeyDiagram")
            .append("div")
            .style("text-align", "center")
            .style("padding", "50px")
            .style("color", "#666")
            .html("Add income data to see the budget flow diagram.<br>Start by adding your first income source above!");
          return;
        }

        const expensesByCategory = {};
        budgetData
          .filter(item => item.type === "Expense")
          .forEach(item => {
            expensesByCategory[item.category] = (expensesByCategory[item.category] || 0) + item.amount;
          });

        const totalExpenses = Object.values(expensesByCategory).reduce((sum, amount) => sum + amount, 0);
        const savings = Math.max(0, totalIncome - totalExpenses);

        // Prepare data for Sankey diagram
        const nodes = [
          { name: "Total Income" },
          ...Object.keys(expensesByCategory).map(category => ({ name: category })),
          { name: "Savings" },
        ];

        const links = [
          ...Object.entries(expensesByCategory).map(([category, amount]) => ({
            source: "Total Income",
            target: category,
            value: amount,
          })),
          { source: "Total Income", target: "Savings", value: savings },
        ];

        // Map node names to indices
        const nodeMap = {};
        nodes.forEach((node, i) => {
          nodeMap[node.name] = i;
        });

        // Format data for D3 Sankey
        const sankeyData = {
          nodes: nodes,
          links: links.map(link => ({
            source: nodeMap[link.source],
            target: nodeMap[link.target],
            value: link.value,
          })),
        };

        // Set up dimensions
        const container = document.getElementById("sankeyDiagram");
        const width = container.clientWidth;
        const height = 400;

        // Create SVG container
        const svg = d3.select("#sankeyDiagram")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", `0 0 ${width} ${height}`)
          .attr("preserveAspectRatio", "xMidYMid meet");

        // Set up Sankey generator
        const sankey = d3.sankey()
          .nodeWidth(15)
          .nodePadding(10)
          .extent([[1, 1], [width - 1, height - 5]]);

        // Compute node and link positions
        const { nodes: sankeyNodes, links: sankeyLinks } = sankey({
          nodes: sankeyData.nodes.map(d => Object.assign({}, d)),
          links: sankeyData.links.map(d => Object.assign({}, d)),
        });

        // Color scale
        const color = d3.scaleOrdinal()
          .domain(["Total Income", "Savings", ...expenseCategories, ...incomeCategories])
          .range([
            "#4b6cb7", // Income
            "#27ae60", // Savings
            "#e74c3c", // Housing
            "#f39c12", // Utilities
            "#e67e22", // Food
            "#3498db", // Transportation
            "#1abc9c", // Healthcare
            "#9b59b6", // Entertainment
            "#8e44ad", // Education
            "#2c3e50", // Shopping
            "#7f8c8d", // Other Expenses
            "#16a085", // Salary
            "#2980b9", // Freelance
            "#c0392b", // Investments
            "#d35400", // Gifts
            "#95a5a6", // Other Income
          ]);

        // Draw the links
        const link = svg.append("g")
          .selectAll("path")
          .data(sankeyLinks)
          .join("path")
          .attr("d", d3.sankeyLinkHorizontal())
          .attr("stroke", d => color(d.source.name))
          .attr("stroke-width", d => Math.max(1, d.width))
          .attr("fill", "none")
          .attr("stroke-opacity", 0.7);

        // Add tooltips to links
        link.append("title")
          .text(d => {
            const percentage = ((d.value / totalIncome) * 100).toFixed(1);
            return `${d.source.name} → ${d.target.name}\n${formatCurrency(d.value)} (${percentage}%)`;
          });

        // Draw the nodes
        const node = svg.append("g")
          .selectAll("g")
          .data(sankeyNodes)
          .join("g")
          .attr("transform", d => `translate(${d.x0},${d.y0})`);

        node.append("rect")
          .attr("height", d => d.y1 - d.y0)
          .attr("width", d => d.x1 - d.x0)
          .attr("fill", d => color(d.name))
          .attr("stroke", d => d3.rgb(color(d.name)).darker(0.5));

        // Add labels with amounts
        node.append("text")
          .attr("x", d => d.x0 < width / 2 ? d.x1 + 10 : d.x0 - 10)
          .attr("y", d => (d.y1 + d.y0) / 2)
          .attr("dy", "0.35em")
          .attr("text-anchor", d => d.x0 < width / 2 ? "start" : "end")
          .text(d => `${d.name}\n${formatCurrency(d.value)}`)
          .style("font-size", "12px")
          .style("font-weight", "600")
          .style("fill", "#2c3e50")
          .style("line-height", "1.2");
      }

      // Show notification
      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // Show modal
      function showModal(modalId) {
        document.getElementById(modalId).style.display = "block";
      }

      // Close all modals
      function closeAllModals() {
        document.querySelectorAll(".modal").forEach(modal => {
          modal.style.display = "none";
        });
      }

      // Reset all data
      function resetAllData() {
        budgetData = [];
        saveToLocalStorage();
        updateUI();
        closeAllModals();
        showNotification("All data has been reset", "success");
      }

      // Export data
      function exportData() {
        const dataStr = JSON.stringify(budgetData, null, 2);
        const dataUri = "data:application/json;charset=utf-8," + encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `budget-data-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement("a");
        linkElement.setAttribute("href", dataUri);
        linkElement.setAttribute("download", exportFileDefaultName);
        linkElement.click();
        
        showNotification("Data exported successfully", "success");
      }

      // Import data
      function importData() {
        const importDataText = document.getElementById("importData").value;
        
        if (!importDataText.trim()) {
          showNotification("Please paste valid JSON data", "error");
          return;
        }

        try {
          const importedData = JSON.parse(importDataText);
          
          // Validate imported data structure
          if (!Array.isArray(importedData)) {
            throw new Error("Data must be an array");
          }
          
          // Basic validation of items
          importedData.forEach(item => {
            if (!item.type || !item.category || !item.amount || !item.date) {
              throw new Error("Invalid data structure");
            }
          });

          budgetData = importedData;
          saveToLocalStorage();
          updateUI();
          closeAllModals();
          document.getElementById("importData").value = "";
          showNotification("Data imported successfully", "success");
        } catch (e) {
          showNotification("Invalid JSON data. Please check the format.", "error");
          console.error("Import error:", e);
        }
      }
    </script>
  </body>
</html>
