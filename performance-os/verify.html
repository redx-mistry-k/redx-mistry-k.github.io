<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify ¬∑ Performance OS</title>
  <link rel="stylesheet" href="styles.css" />
  <base href="/performance-os/">
</head>
<body class="auth-body">
  <div class="auth-card">
    <div class="auth-header">
      <h1>üîê Verify Your Email</h1>
      <p id="emailDisplay">Enter the 6-digit code sent to your email</p>
    </div>

    <form id="verifyForm" onsubmit="handleVerify(event)">
      <div class="input-group">
        <label for="otp">Verification Code</label>
        <input
          type="text"
          id="otp"
          placeholder="000000"
          inputmode="numeric"
          maxlength="6"
          pattern="\d{6}"
          autocomplete="one-time-code"
          required
          autofocus
          class="otp-input"
        />
        <small class="input-hint">Code expires in 5 minutes</small>
      </div>

      <button type="submit" id="submitBtn" class="btn-primary">
        <span class="btn-text">Verify & Continue</span>
        <span class="btn-loader" style="display: none;">
          <span class="spinner"></span>
          Verifying...
        </span>
      </button>

      <div id="status" class="status-message"></div>
    </form>

    <div class="auth-footer">
      <small>
        Didn't receive the code?
        <a href="login.html" class="link">Try again</a>
      </small>
    </div>
  </div>

  <script src="auth.js"></script>
  
  <script>
    function handleVerify(event) {
      event.preventDefault();
      verifyOTP();
    }

    // Display email and auto-focus OTP input
    document.addEventListener('DOMContentLoaded', () => {
      const email = sessionStorage.getItem('login_email');
      if (email) {
        document.getElementById('emailDisplay').textContent = 
          `Enter the code sent to ${email}`;
      }
      
      document.getElementById('otp').focus();
      
      // Auto-format OTP input
      const otpInput = document.getElementById('otp');
      otpInput.addEventListener('input', (e) => {
        // Only allow digits
        e.target.value = e.target.value.replace(/\D/g, '');
        
        // Auto-submit when 6 digits entered
        if (e.target.value.length === 6) {
          setTimeout(() => {
            document.getElementById('verifyForm').requestSubmit();
          }, 300);
        }
      });
      
      // Handle paste
      otpInput.addEventListener('paste', (e) => {
        e.preventDefault();
        const pastedData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 6);
        otpInput.value = pastedData;
        
        if (pastedData.length === 6) {
          setTimeout(() => {
            document.getElementById('verifyForm').requestSubmit();
          }, 300);
        }
      });
    });
  </script>
</body>
</html>
